



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="g10guang">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>Makefile - Memo-刘曦光的备忘录</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.8d40d89b.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#makefile" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Memo-刘曦光的备忘录" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Memo-刘曦光的备忘录
              </span>
              <span class="md-header-nav__topic">
                Makefile
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/g10guang/memo/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Memo-刘曦光的备忘录
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/g10guang/memo/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Memo for myself" class="md-nav__link">
      Memo for myself
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Architect
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Architect
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../architect/《大型网站核心架构》笔记/" title="《大型网站核心架构》笔记" class="md-nav__link">
      《大型网站核心架构》笔记
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Cpp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Cpp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cpp/c++ primer/" title="《c++ primer》" class="md-nav__link">
      《c++ primer》
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Docker
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Docker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../docker/docker-in-short/" title="Docker in short" class="md-nav__link">
      Docker in short
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Git
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Git
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../git/git-in-short/" title="Git in short" class="md-nav__link">
      Git in short
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Http
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Http
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/CORS/" title="CORS" class="md-nav__link">
      CORS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../dotfile执行/" title="dotfile 执行" class="md-nav__link">
      dotfile 执行
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../git设置代理/" title="git 设置代理" class="md-nav__link">
      git 设置代理
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="Makefile" class="md-nav__link md-nav__link--active">
      Makefile
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../makefile_vim/" title="Makefile vim" class="md-nav__link">
      Makefile vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vim/" title="Vim" class="md-nav__link">
      Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../为当前用户安装软件/" title="为当前用户安装软件" class="md-nav__link">
      为当前用户安装软件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../修改键盘映射/" title="修改键盘映射" class="md-nav__link">
      修改键盘映射
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Mkdocs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Mkdocs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mkdocs/安装/" title="安装" class="md-nav__link">
      安装
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/Python虚拟环境创建/" title="Python虚拟环境创建" class="md-nav__link">
      Python虚拟环境创建
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/g10guang/memo/edit/master/docs/linux/makefile.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="makefile">Makefile</h1>
<p><a href="http://wiki.ubuntu.org.cn/跟我一起写Makefile">http://wiki.ubuntu.org.cn/跟我一起写Makefile</a></p>
<p>Unix:</p>
<table>
<thead>
<tr>
<th>Windows</th>
<th>Unix</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>.obj</td>
<td>.o</td>
<td>编译后生成的目标文件，一个源文件对应一个目标文件</td>
</tr>
<tr>
<td>.dll</td>
<td>.so</td>
<td>动态链接库，运行时包含</td>
</tr>
<tr>
<td>.lib</td>
<td>.a</td>
<td>静态链接库，链接生成可执行程序时包含</td>
</tr>
</tbody>
</table>
<p>头文件中应该只出现声明，头文件有可能被多个源文件 include，cpp 中声明可以进行多次，但是定义只能够出现一次。</p>
<p>C/C++ 的寻址方式不完全一样，<code>extern "C"</code>。</p>
<p>正是由于由链接这一步存在，才可以分开编译多个源文件，需要生成可执行程序的时候才进行链接合并，所以在修改某个文件后，只需要重新编译修改过的文件即可。</p>
<p>create dependency auto </p>
<div class="codehilite"><pre><span></span><span class="nf">%.d</span><span class="o">:</span> %.<span class="n">c</span>
    @set -e<span class="p">;</span> rm -f <span class="nv">$@</span><span class="p">;</span> <span class="se">\</span>
         <span class="k">$(</span>CC<span class="k">)</span> -M <span class="k">$(</span>CPPFLAGS<span class="k">)</span> $&lt; &gt; <span class="nv">$@</span>.<span class="nv">$$$$</span><span class="p">;</span> <span class="se">\</span>
         sed <span class="s1">&#39;s,\($*\)\.o[ :]*,\1.o $@ : ,g&#39;</span> &lt; <span class="nv">$@</span>.<span class="nv">$$$$</span> &gt; <span class="nv">$@</span><span class="p">;</span> <span class="se">\</span>
         rm -f <span class="nv">$@</span>.<span class="nv">$$$$</span>

<span class="nv">sources</span> <span class="o">=</span> foo.c bar.c
<span class="nf">&lt;!-- replace .c to .d. eg</span><span class="o">:</span> <span class="n">foo</span>.<span class="n">c</span> ==&gt; <span class="n">foo</span>.<span class="n">d</span> --&gt;
<span class="cp">include $(sources:.c=.d)</span>
</pre></div>


<p>If we place a - before a command, it means no matter the presuccess command execute successfully or not, execute this command any way.</p>
<p>comment #</p>
<p>Makefile will print the command it executes default.</p>
<p>@command to hide the info.</p>
<div class="codehilite"><pre><span></span><span class="err">@echo</span> <span class="err">This</span> <span class="err">message</span> <span class="err">will</span> <span class="err">show</span>
</pre></div>


<p>If we want to make last command make an effect of the next command, we combine them together just like below.</p>
<p>Example 1: don't work:</p>
<div class="codehilite"><pre><span></span><span class="nf">exec</span><span class="o">:</span>
    <span class="nb">cd</span> /home/g10guang
    <span class="nb">pwd</span>
</pre></div>


<p>Example 2: work:</p>
<div class="codehilite"><pre><span></span><span class="nf">exec</span><span class="o">:</span>
    <span class="nb">cd</span> /home/g10guang<span class="p">;</span> <span class="nb">pwd</span>
</pre></div>


<p>Make will check every command return code. If the code is not 0, make will stop. Use <code>-</code> before the command to execute to n matter what return code of previous commands.</p>
<div class="codehilite"><pre><span></span><span class="nf">clean</span><span class="o">:</span>
    -rm -f *.o
</pre></div>


<p>In a big project, write how to compile the project is to complicate. 
So most of time, we will create a Makefile in every subdir to declare how to compile the file of this directory.</p>
<p>Declare the next Makefile can access the variable or not.</p>
<div class="codehilite"><pre><span></span><span class="k">export </span><span class="err">&lt;variable</span> <span class="err">...&gt;;</span>

<span class="err">un</span><span class="k">export </span><span class="err">&lt;variable</span> <span class="err">...&gt;;</span>
</pre></div>


<p>export statement follow with nothing means export all variable.</p>
<div class="codehilite"><pre><span></span><span class="k">export</span>
</pre></div>


<p>Variable in Makefile is just like the macro of C. Variable is the text and it will be replace just as the macro.
The magic thing is we can use the variable which we define after.</p>
<p>Two way to define a variable in Makefile:</p>
<ol>
<li>foo = bar</li>
<li>foo := bar</li>
</ol>
<p>The second way is better, because it tells can not use variables which declare after foo.</p>
<p>Run a command and get the return string:</p>
<div class="codehilite"><pre><span></span><span class="nv">cur-dir</span> <span class="o">:=</span> <span class="k">$(</span>shell <span class="nb">pwd</span><span class="k">)</span>
<span class="nv">whoami</span> <span class="o">:=</span> <span class="k">$(</span>shell whoami<span class="k">)</span>
<span class="nv">host-type</span> <span class="o">:=</span> <span class="k">$(</span>shell arch<span class="k">)</span>
</pre></div>


<p>If FOO has been defined, do nothing. Else set FOO = bar.</p>
<div class="codehilite"><pre><span></span><span class="nv">FOO</span> <span class="o">?=</span> bar
</pre></div>


<p>Use define keyword to declare a multi-line variable.</p>
<div class="codehilite"><pre><span></span><span class="cp">define two-lines</span>
<span class="err">echo</span> <span class="err">foo</span>
<span class="err">echo</span> <span class="k">$(</span><span class="nv">bar</span><span class="k">)</span>
<span class="cp">endef</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="cp">ifeq ($(CC),gcc)</span>
    <span class="k">$(</span>CC<span class="k">)</span> -o foo <span class="k">$(</span>objects<span class="k">)</span> <span class="k">$(</span>libs_for_gcc<span class="k">)</span>
<span class="cp">else</span>
    <span class="k">$(</span>CC<span class="k">)</span> -o foo <span class="k">$(</span>objects<span class="k">)</span> <span class="k">$(</span>normal_libs<span class="k">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="cp">ifdef foo</span>
    <span class="nv">bar</span> <span class="o">=</span> defined
<span class="cp">else</span>
    <span class="nv">bar</span> <span class="o">=</span> undefined
<span class="cp">endif</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="cp">ifndef foo</span>
    <span class="nv">bar</span> <span class="o">=</span> undefined
<span class="cp">else</span>
    <span class="nv">bar</span> <span class="o">=</span> defined
<span class="cp">endif</span>
</pre></div>


<ul>
<li>$&lt;: dependency file</li>
<li>$@: target file</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../git设置代理/" title="git 设置代理" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                git 设置代理
              </span>
            </div>
          </a>
        
        
          <a href="../makefile_vim/" title="Makefile vim" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Makefile vim
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>